<footer class="footer">
    <div class="container">
        <div class="footer-bottom">
            <p>&copy; 2025 GlitchRealm Games. All rights reserved. | <a href="privacy-policy.html" style="color: var(--primary-cyan); text-decoration: none;">Privacy Policy</a> | <a href="terms-of-service.html" style="color: var(--primary-cyan); text-decoration: none;">Terms of Service</a> | <a href="credits.html" style="color: var(--primary-cyan); text-decoration: none;">Credits</a></p>
        </div>
        <div class="netlify-branding">
            <span>Powered by</span>
            <a href="https://www.netlify.com" target="_blank" rel="noopener noreferrer" class="netlify-link">
                <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/netlify/netlify-original.svg" alt="Netlify" class="netlify-logo" loading="lazy" decoding="async" width="24" height="24">
                Netlify
            </a>
        </div>
    </div>
</footer>

<!-- Chatbot FAB is now provided by the widget; custom FAB removed to avoid duplicates -->

<!-- Chatbot widget loader (placed outside the button so it reliably initializes) -->
<script id="doai-chatbot-loader" async
    src="https://kcur57gey4euhzpupakvb43g.agents.do-ai.run/static/chatbot/widget.js"
    data-agent-id="bd55ebc0-7b86-11f0-b074-4e013e2ddde4"
    data-chatbot-id="iLcsXT380jITKSw3t6GQxi14J3z3bc64"
    data-name="GlitchRealm Bot"
    data-primary-color="#00FFF9"
    data-secondary-color="#E5E8ED"
    data-button-background-color="#0A1629"
    data-starting-message="Hello! How can I help you today?"
    data-logo="assets/glitch realm favicon image.png"></script>

<!-- Open handler: resilient detection + retry -->
<script>
    (function () {
        let openFn = null;
        const loader = document.getElementById('doai-chatbot-loader');

        function resolveOpenFn() {
            const g = window;
            const namespaces = [
                g.DOAIChatbot, g.DoAIChatbot, g.doAIChatbot, g.doaiChatbot,
                g.DOAI, g.DoAI, g.doAI, g.doai
            ].filter(Boolean);

            // Also try to discover any window keys that look like doai
            try {
                for (const k of Object.keys(g)) {
                    if (/doai|DoAI|DOAI/i.test(k)) {
                        try { namespaces.push(g[k]); } catch (e) {}
                    }
                }
            } catch (e) {}

            const methodNames = ['open', 'toggle', 'show', 'start', 'expand', 'openChat', 'openWidget', 'openChatbot'];
            for (const ns of namespaces) {
                if (!ns) continue;
                for (const m of methodNames) {
                    try { if (typeof ns[m] === 'function') return () => ns[m](); } catch (e) {}
                }
                // Nested widget object
                try {
                    if (ns.widget) {
                        for (const m of methodNames) {
                            if (typeof ns.widget[m] === 'function') return () => ns.widget[m]();
                        }
                    }
                } catch (e) {}
            }
            return null;
        }

        function showHint(msg, isError) {
            const el = document.createElement('div');
            el.textContent = msg;
            el.style.position = 'fixed';
            el.style.right = '90px';
            el.style.bottom = '26px';
            el.style.padding = '8px 12px';
            el.style.border = '1px solid var(--primary-cyan)';
            el.style.background = 'rgba(0,0,0,0.85)';
            el.style.color = isError ? 'var(--danger)' : 'var(--primary-cyan)';
            el.style.borderRadius = '6px';
            el.style.zIndex = '2300';
            el.style.fontFamily = 'Rajdhani, sans-serif';
            el.style.fontSize = '0.9rem';
            document.body.appendChild(el);
            setTimeout(() => { el.remove(); }, 2000);
        }

        function tryOpen() {
            if (!openFn) openFn = resolveOpenFn();
            if (openFn) {
                try { openFn(); return true; } catch (e) {}
            }
            try { window.dispatchEvent(new CustomEvent('doai:open')); } catch (e) {}
            try { window.dispatchEvent(new Event('doai-open')); } catch (e) {}
            // Also try a postMessage hint in case the widget listens for it
            try { window.postMessage({ type: 'doai:open' }, '*'); } catch (e) {}
            return false;
        }

        // Listen for ready signals
        ['doai:ready', 'doai-ready', 'DoAI:ready', 'DOMContentLoaded', 'load'].forEach(evt => {
            window.addEventListener(evt, () => { openFn = resolveOpenFn(); });
        });

        // Also detect readiness via postMessage origin
        window.addEventListener('message', (ev) => {
            try {
                if (typeof ev.origin === 'string' && ev.origin.includes('agents.do-ai.run')) {
                    openFn = resolveOpenFn();
                }
            } catch (e) {}
        });

        if (loader) {
            loader.addEventListener('load', () => { openFn = resolveOpenFn(); });
            loader.addEventListener('error', () => { showHint('Chatbot failed to load', true); });
        }

        const btn = document.getElementById('chatbot-fab');
        if (btn) {
            btn.addEventListener('click', function () {
                showHint('Opening chat…');
                if (tryOpen()) return;
                setTimeout(() => { if (!tryOpen()) showHint('Chatbot still loading…'); }, 600);
                setTimeout(() => { if (!tryOpen()) showHint('Chatbot not ready', true); }, 2000);
            });
        }
    })();
</script>

<!-- Structured Data: inject JSON-LD into <head> on every page -->
<script>
    (function addStructuredData() {
        try {
            if (document.getElementById('gr-structured-data')) return;
            var data = {
                "@context": "https://schema.org",
                "@graph": [
                    {
                        "@type": "Organization",
                        "@id": "https://glitchrealm.ca/#organization",
                        "name": "GlitchRealm",
                        "alternateName": "GlitchRealm Games",
                        "url": "https://glitchrealm.ca",
                        "description": "GlitchRealm is a browser-based gaming platform and community. Play original indie titles, track progress, and connect with fellow players.",
                                                "logo": {
                                                    "@type": "ImageObject",
                                                    "url": "https://glitchrealm.ca/assets/glitch%20realm%20favicon%20image.png"
                                                },
                        "sameAs": [
                            "https://github.com/InfinityByteStudios",
                            "https://twitter.com/GlitchRealm",
                            "https://glitchrealm.itch.io"
                        ],
                        "contactPoint": [
                            {
                                "@type": "ContactPoint",
                                "contactType": "customer support",
                                "email": "glitchrealm@outlook.com"
                            }
                        ]
                    },
                    {
                        "@type": "WebSite",
                        "@id": "https://glitchrealm.ca/#website",
                        "url": "https://glitchrealm.ca",
                        "name": "GlitchRealm",
                        "description": "Cyberpunk-inspired indie games and a friendly gaming community—play in your browser on GlitchRealm.",
                        "inLanguage": "en",
                        "publisher": { "@id": "https://glitchrealm.ca/#organization" }
                    },
                    {
                        "@type": "VideoGame",
                        "@id": "https://glitchrealm.ca/#game-bytesurge",
                        "name": "ByteSurge",
                        "url": "https://glitchrealm.ca/Games/ByteSurge/",
                        "description": "An original browser game available on the GlitchRealm platform.",
                        "applicationCategory": "Game",
                        "operatingSystem": "Web",
                        "inLanguage": "en",
                        "image": { "@type": "ImageObject", "url": "https://glitchrealm.ca/assets/glitch%20realm%20favicon%20image.png" },
                        "author": { "@id": "https://glitchrealm.ca/#organization" },
                        "publisher": { "@id": "https://glitchrealm.ca/#organization" }
                    }
                ]
            };
            var el = document.createElement('script');
            el.type = 'application/ld+json';
            el.id = 'gr-structured-data';
            el.text = JSON.stringify(data);
            (document.head || document.documentElement).appendChild(el);
        } catch (e) { /* no-op */ }
    })();
    // Hint: Use a square-ish transparent logo (>=112x112). If you update it, change the URL above.
</script>
