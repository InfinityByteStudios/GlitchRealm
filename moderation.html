<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Moderation - GlitchRealm</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" type="image/png" href="/assets/Favicon and Icons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/assets/Favicon and Icons/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/Favicon and Icons/apple-touch-icon.png" />
    <link rel="stylesheet" href="styles.css">
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet"></noscript>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <style>
        /* Page tweaks */
        .logo .games-text { display: inline-block; margin-left: 8px; }
        .nav-container { padding-top: 1.1rem; padding-bottom: 1.1rem; }
        /* Reports list styling (reused from community) */
        #mod-reports-list { display:flex; flex-direction:column; gap:10px; margin-top:10px; }
        .mod-report-row { display:flex; align-items:flex-start; justify-content:space-between; gap:10px; border:1px solid var(--gray-700); background: rgba(255,255,255,0.02); padding:12px; border-radius:12px; }
        .mrr-main { flex:1; min-width:0; }
        .mrr-title { font-weight:800; letter-spacing:.3px; }
        .mrr-meta { opacity:.85; font-size:.92rem; }
        .mrr-actions { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
        .access-note { opacity:.85; }
    </style>

    <!-- Unified Firebase core (loads app+auth once, sets local persistence) -->
    <script type="module" src="firebase-core.js"></script>
    <!-- Firebase SDK init (module; reuses shared app/auth if present) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCo5hr7ULHLL_0UAAst74g8ePZxkB7OHFQ",
            authDomain: "shared-sign-in.firebaseapp.com",
            projectId: "shared-sign-in",
            storageBucket: "shared-sign-in.appspot.com",
            messagingSenderId: "332039027753",
            appId: "1:332039027753:web:aa7c6877d543bb90363038",
            measurementId: "G-KK5XVVLMVN"
        };

        const app = window.firebaseApp || initializeApp(firebaseConfig);
        const auth = window.firebaseAuth || getAuth(app);
        try { getAnalytics(app); } catch (e) {}
        // Expose for global scripts
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseConfig = firebaseConfig;
        
        // Force UI update when auth state changes
        auth.onAuthStateChanged((user) => {
            console.log('[Moderation Page] Auth state changed:', user ? user.uid : 'signed out');
            
            // Force update header UI
            setTimeout(() => {
                const signInBtn = document.getElementById('sign-in-btn');
                const userProfile = document.getElementById('user-profile');
                
                if (user) {
                    console.log('[Moderation Page] User signed in, updating UI');
                    if (signInBtn) signInBtn.style.display = 'none';
                    if (userProfile) userProfile.style.display = 'flex';
                    
                    // Update user profile if function exists
                    if (typeof updateUserProfile === 'function') {
                        updateUserProfile(user);
                    }
                } else {
                    console.log('[Moderation Page] User signed out, updating UI');
                    if (signInBtn) signInBtn.style.display = 'block';
                    if (userProfile) userProfile.style.display = 'none';
                }
            }, 100);
        });
    </script>
</head>
<body class="mod-page">
    <div class="background-animation"></div>
    <div id="header-placeholder"></div>

    <main class="main">
        <section class="games-hero">
            <div class="container">
                <h1 class="page-title">
                    <span class="glitch" data-text="Moderation">Moderation</span>
                </h1>
                <p class="page-subtitle">Review and manage reports, verification, and game submissions</p>
            </div>
        </section>

        <section class="contact-content">
            <div class="container">
                <div id="mod-access" class="access-note">Checking access…</div>
                <div id="mod-reports-controls" style="display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin:12px 0; display:none;">
                    <div style="display:flex; gap:10px; align-items:center; opacity:.95; flex-wrap:wrap;">
                        <div style="opacity:.85;">Latest reports</div>
                        <label style="display:flex; align-items:center; gap:6px; opacity:.85;">
                            <span>Source:</span>
                            <select id="mod-reports-source" class="neural-input" style="min-width:170px;">
                                <option value="community">Community posts</option>
                                <option value="games">Game reports</option>
                            </select>
                        </label>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button id="mod-refresh" class="neural-button secondary"><span class="button-text">Refresh</span></button>
                        <a href="community.html" class="neural-button secondary"><span class="button-text">Go to Community</span></a>
                    </div>
                </div>
                <div id="mod-reports-list"></div>

                <hr style="margin:24px 0; border-color: var(--gray-800);">

                <div id="mod-verify-controls" style="display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin:12px 0; display:none;">
                    <div style="display:flex; gap:10px; align-items:center; opacity:.95; flex-wrap:wrap;">
                        <div style="opacity:.85;">Verification requests</div>
                        <label style="display:flex; align-items:center; gap:6px; opacity:.85;">
                            <span>Source:</span>
                            <select id="mod-verify-source" class="neural-input" style="min-width:170px;">
                                <option value="verified-users">User Verification</option>
                                <option value="writer-verification">Writer Verification</option>
                            </select>
                        </label>
                        <label style="display:flex; align-items:center; gap:6px; opacity:.85;">
                            <span>Show:</span>
                            <select id="mod-verify-filter" class="neural-input" style="min-width:140px;">
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="denied">Denied</option>
                                <option value="all">All</option>
                            </select>
                        </label>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button id="mod-verify-refresh" class="neural-button secondary"><span class="button-text">Refresh</span></button>
                    </div>
                </div>
                <div id="mod-verify-list" style="display:flex; flex-direction:column; gap:10px;"></div>

                <hr style="margin:24px 0; border-color: var(--gray-800);">

                <div id="mod-gamesub-controls" style="display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin:12px 0; display:none;">
                    <div style="opacity:.85;">Game submissions</div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <label style="display:flex; align-items:center; gap:6px; opacity:.85;">
                            <span>Show:</span>
                            <select id="mod-gamesub-filter" class="neural-input" style="min-width:140px;">
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                                <option value="all">All</option>
                            </select>
                        </label>
                        <button id="mod-gamesub-refresh" class="neural-button secondary"><span class="button-text">Refresh</span></button>
                    </div>
                </div>
                <div id="mod-gamesub-list" style="display:flex; flex-direction:column; gap:10px;"></div>

                <hr style="margin:24px 0; border-color: var(--gray-800);">

                <!-- System Status Management -->
                <div id="mod-status-section" style="display:none;">
                    <h2 style="margin:0 0 16px; font-size:1.4rem; letter-spacing:.5px; color:#00f5ff;">System Status Management</h2>
                    
                    <!-- Quick Status Presets -->
                    <div style="margin-bottom:24px;">
                        <h3 style="font-size:.9rem; letter-spacing:.5px; color:#7edcf0; margin:0 0 12px; text-transform:uppercase;">Quick Presets</h3>
                        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:10px;">
                            <!-- Operational Presets -->
                            <button type="button" class="status-preset-btn" data-status="operational" data-message="All Systems Operational" data-description="All services are running normally. No issues reported." style="padding:10px 14px; background:rgba(0,255,0,0.1); border:1px solid rgba(0,255,0,0.3); border-radius:8px; color:#00ff66; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">✅ All Systems Operational</div>
                                <div style="font-size:.7rem; opacity:.8;">Everything running smoothly</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="operational" data-message="System Restored" data-description="All services have been restored and are functioning normally. Thank you for your patience." style="padding:10px 14px; background:rgba(0,255,0,0.1); border:1px solid rgba(0,255,0,0.3); border-radius:8px; color:#00ff66; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">✅ System Restored</div>
                                <div style="font-size:.7rem; opacity:.8;">Back to normal operations</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="operational" data-message="Maintenance Complete" data-description="Scheduled maintenance has been completed successfully. All features are now available." style="padding:10px 14px; background:rgba(0,255,0,0.1); border:1px solid rgba(0,255,0,0.3); border-radius:8px; color:#00ff66; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">✅ Maintenance Complete</div>
                                <div style="font-size:.7rem; opacity:.8;">Updates finished successfully</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="operational" data-message="Update Finished" data-description="A platform update has finished rolling out successfully. Systems are back to normal operation. Let us know if you notice any lingering issues." style="padding:10px 14px; background:rgba(0,255,0,0.1); border:1px solid rgba(0,255,0,0.3); border-radius:8px; color:#00ff66; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">✅ Update Finished</div>
                                <div style="font-size:.7rem; opacity:.8;">Rollout completed</div>
                            </button>
                            
                            <!-- Degraded Presets -->
                            <button type="button" class="status-preset-btn" data-status="degraded" data-message="Experiencing Minor Issues" data-description="We're experiencing some minor performance issues. Some features may be slower than usual. Our team is actively working to resolve this." style="padding:10px 14px; background:rgba(255,170,0,0.1); border:1px solid rgba(255,170,0,0.3); border-radius:8px; color:#ffaa00; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">⚠️ Experiencing Minor Issues</div>
                                <div style="font-size:.7rem; opacity:.8;">Some features may be slow</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="degraded" data-message="Scheduled Maintenance" data-description="Planned maintenance is currently underway to improve system performance. Some features may be temporarily unavailable or slower during this time." style="padding:10px 14px; background:rgba(255,170,0,0.1); border:1px solid rgba(255,170,0,0.3); border-radius:8px; color:#ffaa00; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">⚠️ Scheduled Maintenance</div>
                                <div style="font-size:.7rem; opacity:.8;">Planned updates in progress</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="degraded" data-message="High Traffic Load" data-description="We're experiencing higher than normal traffic. Services remain operational but may respond slower than usual. We're monitoring the situation closely." style="padding:10px 14px; background:rgba(255,170,0,0.1); border:1px solid rgba(255,170,0,0.3); border-radius:8px; color:#ffaa00; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">⚠️ High Traffic Load</div>
                                <div style="font-size:.7rem; opacity:.8;">Service may be slower than usual</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="degraded" data-message="Update Rolling Out" data-description="A new platform update is currently rolling out. Some users may experience temporary glitches, missing assets, or slower responses while propagation completes." style="padding:10px 14px; background:rgba(255,170,0,0.1); border:1px solid rgba(255,170,0,0.3); border-radius:8px; color:#ffaa00; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">⚠️ Update Rolling Out</div>
                                <div style="font-size:.7rem; opacity:.8;">Temporary issues possible</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="degraded" data-message="Post-Update Issues" data-description="We're investigating issues reported after the recent update. Some features may behave unexpectedly while a fix is prepared." style="padding:10px 14px; background:rgba(255,170,0,0.1); border:1px solid rgba(255,170,0,0.3); border-radius:8px; color:#ffaa00; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">⚠️ Post-Update Issues</div>
                                <div style="font-size:.7rem; opacity:.8;">Fix in progress</div>
                            </button>
                            
                            <!-- Down Presets -->
                            <button type="button" class="status-preset-btn" data-status="down" data-message="Service Temporarily Unavailable" data-description="Our services are currently unavailable due to technical difficulties. Our team is working urgently to restore service as quickly as possible." style="padding:10px 14px; background:rgba(255,0,0,0.1); border:1px solid rgba(255,0,0,0.3); border-radius:8px; color:#ff6666; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">❌ Service Temporarily Unavailable</div>
                                <div style="font-size:.7rem; opacity:.8;">Working to restore service</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="down" data-message="Emergency Maintenance" data-description="Emergency maintenance is being performed to address critical issues. Services will be restored as soon as possible. We apologize for the inconvenience." style="padding:10px 14px; background:rgba(255,0,0,0.1); border:1px solid rgba(255,0,0,0.3); border-radius:8px; color:#ff6666; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">❌ Emergency Maintenance</div>
                                <div style="font-size:.7rem; opacity:.8;">Urgent updates required</div>
                            </button>
                            <button type="button" class="status-preset-btn" data-status="down" data-message="Database Issues" data-description="We're currently investigating database connectivity issues affecting service availability. Our technical team is working to resolve this as quickly as possible." style="padding:10px 14px; background:rgba(255,0,0,0.1); border:1px solid rgba(255,0,0,0.3); border-radius:8px; color:#ff6666; font-size:.8rem; cursor:pointer; transition:all .2s ease; text-align:left;">
                                <div style="font-weight:700; margin-bottom:4px;">❌ Database Issues</div>
                                <div style="font-size:.7rem; opacity:.8;">Investigating database problems</div>
                            </button>
                        </div>
                    </div>
                    
                    <form id="status-form" style="display:flex; flex-direction:column; gap:18px; max-width:700px;">
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:.85rem; font-weight:600; color:#7edcf0; text-transform:uppercase; letter-spacing:.5px;">System Status</label>
                            <select id="status-select" class="neural-input" required>
                                <option value="operational">✅ Operational - All systems running normally</option>
                                <option value="degraded">⚠️ Degraded - Some features may be slow</option>
                                <option value="down">❌ Down - System experiencing issues</option>
                            </select>
                        </div>
                        
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:.85rem; font-weight:600; color:#7edcf0; text-transform:uppercase; letter-spacing:.5px;">Status Message</label>
                            <input type="text" id="status-message" class="neural-input" placeholder="Select a preset above or type your own..." maxlength="100" required />
                            <small style="font-size:.75rem; opacity:.7;"><span id="message-counter">0</span>/100 characters • Use quick presets or write a custom message</small>
                        </div>
                        
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:.85rem; font-weight:600; color:#7edcf0; text-transform:uppercase; letter-spacing:.5px;">Description (Optional)</label>
                            <textarea id="status-description" class="neural-input" placeholder="Provide details about the current status, what's affected, expected resolution time, etc." style="min-height:100px; resize:vertical;" maxlength="1000"></textarea>
                            <small style="font-size:.75rem; opacity:.7;"><span id="desc-counter">0</span>/1000 characters • Only visible if you add text here. Users can click the 'i' icon to view.</small>
                        </div>
                        
                        <button type="submit" class="neural-button"><span class="button-text">Update Status</span></button>
                    </form>
                    
                    <div id="status-success-msg" style="display:none; background:rgba(0,255,100,0.1); border:1px solid rgba(0,255,100,0.3); padding:14px; border-radius:8px; color:#00ff66; margin-top:16px;">
                        Status updated successfully!
                    </div>
                    <div id="status-error-msg" style="display:none; background:rgba(255,100,100,0.1); border:1px solid rgba(255,100,100,0.3); padding:14px; border-radius:8px; color:#ff6666; margin-top:16px;">
                        Error updating status. Please try again.
                    </div>
                    
                    <div style="margin-top:20px; padding:14px 18px; background:linear-gradient(135deg,rgba(11,24,34,0.9),rgba(7,16,23,0.95)); border:1px solid rgba(0,255,249,0.2); border-radius:12px; display:flex; align-items:center; gap:12px;">
                        <div id="preview-indicator" style="width:10px; height:10px; border-radius:50%; background:#00ff00; box-shadow:0 0 10px #00ff00;"></div>
                        <div style="flex:1;">
                            <div style="font-weight:700; font-size:.9rem; color:#fff;">Preview: <span id="preview-text">All Systems Operational</span></div>
                            <div id="preview-description" style="display:none; margin-top:8px; font-size:.8rem; color:#b8d4d8; padding-top:8px; border-top:1px solid rgba(0,255,249,0.15);"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="footer-placeholder"></div>

    <!-- Firebase compat libs (optional) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js" defer></script>
    <script defer>
        (function(){
            function initCompat(){
                try {
                    if (window.firebase && window.firebaseConfig && (!window.firebase.apps || !window.firebase.apps.length)) {
                        window.firebase.initializeApp(window.firebaseConfig);
                        try { window.firebase.auth(); } catch(e) {}
                    }
                } catch(e) {}
            }
            if (document.readyState === 'complete' || document.readyState === 'interactive') initCompat();
            else document.addEventListener('DOMContentLoaded', initCompat);
        })();
    </script>
    <script src="script.js?v=20251002" defer></script>
    <script src="moderation.js?v=20251002" defer></script>
</body>
<script>(function(){const c={src:'https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js',id:'glitchrealmdevs',desc:'Support me on Buy me a coffee!',msg:'Contribute to the development of GlitchRealm.',color:'#5F7FFF',pos:'Right',x:'18',y:'18'};function i(){if(document.getElementById('bmc-widget-script'))return;const s=document.createElement('script');s.id='bmc-widget-script';s.src=c.src;s.dataset.name='BMC-Widget';s.setAttribute('data-cfasync','false');s.setAttribute('data-id',c.id);s.setAttribute('data-description',c.desc);s.setAttribute('data-message',c.msg);s.setAttribute('data-color',c.color);s.setAttribute('data-position',c.pos);s.setAttribute('data-x_margin',c.x);s.setAttribute('data-y_margin',c.y);document.body.appendChild(s);}if(window.requestIdleCallback)requestIdleCallback(i,{timeout:2500});else window.addEventListener('load',()=>setTimeout(i,600));['pointerdown','keydown','scroll'].forEach(e=>window.addEventListener(e,i,{once:true,passive:true}));})();</script>
</html>
