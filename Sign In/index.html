<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlitchRealm Access - Sign In</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="./signin.css">
</head>
<body>
    <div id="signin-modal" class="auth-overlay" style="display: flex;">
        <div class="auth-panel" role="dialog" aria-modal="true" aria-labelledby="auth-title">
            <div class="auth-header">
                <div class="auth-logo">
                    <span class="glitch" id="auth-title" data-text="GLITCHREALM ACCESS">GLITCHREALM ACCESS</span>
                </div>
                <button class="auth-close" id="close-modal" aria-label="Close">
                    <span class="close-icon">Ã—</span>
                </button>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="signin">
                    <span class="tab-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24"><path d="M10,17V14H3V10H10V7L15,12L10,17M10,2H19A2,2 0 0,1 21,4V20A2,2 0 0,1 19,22H10A2,2 0 0,1 8,20V18H10V20H19V4H10V6H8V4A2,2 0 0,1 10,2Z"/></svg>
                    </span>
                    <span>SIGN IN</span>
                </button>
                <button class="auth-tab" data-tab="signup">
                    <span class="tab-icon">
                        <svg class="icon-svg" viewBox="0 0 24 24"><path d="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z"/></svg>
                    </span>
                    <span>SIGN UP</span>
                </button>
            </div>

            <div id="authMessage" class="auth-message hidden"></div>

            <div class="auth-content">
                <div class="auth-form-container active" id="signin-form">
                    <div class="form-title"><span class="glitch-small" data-text="AUTHENTICATE">AUTHENTICATE</span></div>
                    <form id="email-signin-form" class="neural-form">
                        <div class="input-container">
                            <div class="input-label">Email/Username</div>
                            <input type="email" id="signin-email" class="neural-input" autocomplete="username" required>
                            <div class="input-line"></div>
                        </div>
                        <div class="input-container">
                            <div class="input-label">Password</div>
                            <input type="password" id="signin-password" class="neural-input" autocomplete="current-password" required>
                            <div class="input-line"></div>
                        </div>
                        <button type="submit" class="neural-button primary"><span class="button-text">INITIATE CONNECTION</span><div class="button-glow"></div></button>
                        <button type="button" class="forgot-link"><span>Forgot Password?</span></button>
                    </form>
                </div>

                <div class="auth-form-container" id="signup-form">
                    <div class="form-title"><span class="glitch-small" data-text="INITIALIZE">INITIALIZE</span></div>
                    <form id="email-signup-form" class="neural-form">
                        <div class="input-container">
                            <div class="input-label">Email</div>
                            <input type="email" id="signup-email" class="neural-input" autocomplete="username" required>
                            <div class="input-line"></div>
                        </div>
                        <div class="input-container">
                            <div class="input-label">Password</div>
                            <input type="password" id="signup-password" class="neural-input" autocomplete="new-password" minlength="6" required>
                            <div class="input-line"></div>
                        </div>
                        <div class="input-container">
                            <div class="input-label">Confirm Password</div>
                            <input type="password" id="confirm-password" class="neural-input" autocomplete="new-password" minlength="6" required>
                            <div class="input-line"></div>
                        </div>
                        <button type="submit" class="neural-button primary"><span class="button-text">CREATE NEURAL LINK</span><div class="button-glow"></div></button>
                    </form>
                </div>

                <div class="auth-divider"><div class="divider-line"></div><span class="divider-text">ALTERNATIVE ACCESS</span><div class="divider-line"></div></div>

                <div class="social-auth">
                    <button id="google-signin" class="social-button google">
                        <img src="https://fonts.gstatic.com/s/i/productlogos/googleg/v6/24px.svg" alt="Google" class="social-icon" loading="lazy" decoding="async" width="24" height="24">
                        <span id="google-button-text">Sign in with Google</span>
                        <div class="social-glow"></div>
                    </button>
                    <button id="github-signin" class="social-button github">
                        <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub" class="social-icon" loading="lazy" decoding="async" width="24" height="24">
                        <span id="github-button-text">Sign in with GitHub</span>
                        <div class="social-glow"></div>
                    </button>
                    <button id="anonymous-signin" class="social-button guest">
                        <img src="https://cdn.jsdelivr.net/gh/feathericons/feather/icons/user.svg" alt="Anonymous" class="social-icon" loading="lazy" decoding="async" width="24" height="24">
                        <span>ANONYMOUS MODE</span>
                        <div class="social-glow"></div>
                    </button>
                </div>

                <div class="terms-agreement">
                    <p>By signing in / signing up you agree to our <a href="../terms-of-service.html" target="_blank">Terms of Service</a> and <a href="../privacy-policy.html" target="_blank">Privacy Policy</a>.</p>
                </div>
            </div>

            <div class="auth-bg-effect"></div>
            <div class="auth-scanlines"></div>
        </div>
    </div>

    <script type="module" src="./signin.js"></script>
    <script>
        // Close/back behavior using original IDs/classes
        (function(){
            const overlay = document.getElementById('signin-modal');
            const closeBtn = document.getElementById('close-modal');

            function getReturnUrl() {
                const params = new URLSearchParams(window.location.search);
                const redirect = params.get('redirect');
                try {
                    const stored = sessionStorage.getItem('gr.returnTo');
                    if (redirect) return decodeURIComponent(redirect);
                    if (stored) return stored;
                } catch {}
                return '../index.html';
            }

            function goBack() {
                try { sessionStorage.removeItem('gr.returnTo'); } catch {}
                const url = getReturnUrl();
                window.location.href = url;
            }

            closeBtn?.addEventListener('click', (e) => { e.preventDefault(); goBack(); });
            overlay?.addEventListener('click', (e) => { if (e.target === overlay) goBack(); });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') goBack(); });
        })();
    </script>
</body>
</html>